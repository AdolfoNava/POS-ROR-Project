import*as e from"jquery";var t="default"in e?e.default:e;var a="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var i={};(function(e){i=e(t)})((function(e){var t=e.keyboard=function(i,n){var s,r=this||a;r.version="1.30.4";r.$el=e(i);r.el=i;r.$el.data("keyboard",r);r.init=function(){r.initialized=false;r.isTextArea="textarea"===r.el.nodeName.toLowerCase();r.isInput="input"===r.el.nodeName.toLowerCase();r.isContentEditable=!r.isTextArea&&!r.isInput&&r.el.isContentEditable;var a,i,o,l=t.css,c=t.events;if(r.isInput&&e.inArray((r.el.type||"").toLowerCase(),t.supportedInputTypes)<0)throw new TypeError('Input of type "'+r.el.type+'" is not supported; use type text, search, URL, tel or password');r.settings=n||{};if(n&&n.position){i=e.extend({},n.position);n.position=null}r.options=s=e.extend(true,{},t.defaultOptions,n);if(i){s.position=i;n.position=i}r.el.active=true;r.namespace=".keyboard"+Math.random().toString(16).slice(2);r.extensionNamespace=[];r.shiftActive=r.altActive=r.metaActive=r.sets=r.capsLock=false;r.rows=["","-shift","-alt","-alt-shift"];r.inPlaceholder=r.$el.attr("placeholder")||"";r.watermark=t.watermark&&""!==r.inPlaceholder;r.repeatTime=1e3/(s.repeatRate||20);s.preventDoubleEventTime=s.preventDoubleEventTime||100;r.isOpen=false;r.wheel="function"===typeof e.fn.mousewheel;r.escapeRegex=/[-\/\\^$*+?.()|[\]{}]/g;a=t.keyCodes;r.alwaysAllowed=[a.capsLock,a.pageUp,a.pageDown,a.end,a.home,a.left,a.up,a.right,a.down,a.insert,a.delete];r.$keyboard=[];r.enabled=true;r.checkCaret=s.lockInput||t.checkCaretSupport();r.isContentEditable&&(s.usePreview=false);r.last={start:0,end:0,key:"",val:"",preVal:"",layout:"",virtual:true,keyset:[false,false,false],wheel_$Keys:[],wheelIndex:0,wheelLayers:[]};r.temp=["",0,0];e.each([c.kbInit,c.kbBeforeVisible,c.kbVisible,c.kbHidden,c.inputCanceled,c.inputAccepted,c.kbBeforeClose,c.inputRestricted],(function(e,t){"function"===typeof s[t]&&r.$el.bind(t+r.namespace+"callbacks",s[t])}));s.alwaysOpen&&(s.stayOpen=true);o=e(document);r.el.ownerDocument!==document&&(o=o.add(r.el.ownerDocument));var u="keyup checkkeyboard mousedown touchstart ";s.closeByClickEvent&&(u+="click ");o.bind(u.split(" ").join(r.namespace+" "),(function(e){clearTimeout(r.timer3);r.timer3=setTimeout((function(){r.checkClose(e)}),1)}));r.$el.addClass(l.input+" "+s.css.input).attr({"aria-haspopup":"true",role:"textbox"});if(s.lockInput||r.el.readOnly){s.lockInput=true;r.$el.addClass(l.locked).attr({readonly:"readonly"})}r.isUnavailable()&&r.$el.addClass(l.noKeyboard);s.openOn&&r.bindFocus();if(!r.watermark&&""===r.getValue(r.$el)&&""!==r.inPlaceholder&&""!==r.$el.attr("placeholder")){r.$el.addClass(l.placeholder);r.setValue(r.inPlaceholder,r.$el)}r.$el.trigger(c.kbInit,[r,r.el]);s.alwaysOpen&&r.reveal();r.initialized=true};r.toggle=function(){if(r.hasKeyboard()){var e=r.$keyboard.find("."+t.css.keyToggle),i=!r.enabled;r.preview.readonly=i||r.options.lockInput;r.$keyboard.toggleClass(t.css.keyDisabled,i).find("."+t.css.keyButton).not(e).attr("aria-disabled",i).each((function(){(this||a).disabled=i}));e.toggleClass(t.css.keyDisabled,i);i&&r.typing_options&&(r.typing_options.text="");return r}};r.setCurrent=function(){var a=t.css,i=e("."+a.isCurrent),n=i.data("keyboard");e.isEmptyObject(n)||n.el===r.el||n.close(!!n.options.autoAccept&&"true");i.removeClass(a.isCurrent);e("."+a.hasFocus).removeClass(a.hasFocus);r.$el.addClass(a.isCurrent);r.$preview.focus();r.$keyboard.addClass(a.hasFocus);r.isCurrent(true);r.isOpen=true};r.isUnavailable=function(){return r.$el.is(":disabled")||!r.options.activeOnReadonly&&r.$el.attr("readonly")&&!r.$el.hasClass(t.css.locked)};r.isCurrent=function(e){var a=t.currentKeyboard||false;e?a=t.currentKeyboard=r.el:false===e&&a===r.el&&(a=t.currentKeyboard="");return a===r.el};r.hasKeyboard=function(){return r.$keyboard&&r.$keyboard.length>0};r.isVisible=function(){return!!r.hasKeyboard()&&r.$keyboard.is(":visible")};r.setFocus=function(){var e=r.$preview||r.$el;s.noFocus||e.focus();r.isContentEditable?t.setEditableCaret(e,r.last.start,r.last.end):t.caret(e,r.last)};r.focusOn=function(){if(r&&r.el.active)if(r.isVisible())r.setCurrent();else{clearTimeout(r.timer);r.reveal()}};r.redraw=function(e){e&&(r.options.layout=e);if(r.$keyboard.length){r.last.preVal=""+r.last.val;r.saveLastChange();r.setValue(r.last.val,r.$el);r.removeKeyboard();r.shiftActive=r.altActive=r.metaActive=false}r.isOpen=s.alwaysOpen;r.reveal(true);return r};r.reveal=function(i){var n,o=r.isOpen,l=t.css;r.opening=!o;e("."+l.keyboard).not("."+l.alwaysOpen).each((function(){var t=e(this||a).data("keyboard");e.isEmptyObject(t)||t.close(!!t.options.autoAccept&&"true")}));if(!r.isUnavailable()){r.$el.removeClass(l.noKeyboard);s.openOn&&r.$el.unbind(e.trim((s.openOn+" ").split(/\s+/).join(r.namespace+" ")));r.$keyboard&&(!r.$keyboard||r.$keyboard.length&&!e.contains(r.el.ownerDocument.body,r.$keyboard[0]))||r.startup();if(!r.watermark&&r.getValue()===r.inPlaceholder){r.$el.removeClass(l.placeholder);r.setValue("",r.$el)}r.originalContent=r.isContentEditable?r.$el.html():r.getValue(r.$el);r.el===r.preview||r.isContentEditable||r.setValue(r.originalContent);s.acceptValid&&s.checkValidOnInit&&r.checkValid();s.resetDefault&&(r.shiftActive=r.altActive=r.metaActive=false);r.showSet();r.isVisible()||r.$el.trigger(t.events.kbBeforeVisible,[r,r.el]);(r.initialized||s.initialFocus||!s.initialFocus&&r.$el.hasClass(t.css.initialFocus))&&r.setCurrent();r.toggle();r.$keyboard.show();if(s.usePreview&&t.msie){if("undefined"===typeof r.width){r.$preview.hide();r.width=Math.ceil(r.$keyboard.width());r.$preview.show()}r.$preview.width(r.width)}r.reposition();r.checkDecimal();r.lineHeight=parseInt(r.$preview.css("lineHeight"),10)||parseInt(r.$preview.css("font-size"),10)+4;if(s.caretToEnd){n=r.isContentEditable?t.getEditableLength(r.el):r.originalContent.length;r.saveCaret(n,n)}if(t.allie){0===r.last.end&&r.last.start>0&&(r.last.end=r.last.start);r.last.start<0&&(r.last.start=r.last.end=r.originalContent.length)}if(o||i){t.caret(r.$preview,r.last);r.opening=false;return r}r.timer2=setTimeout((function(){var e;r.opening=false;/(number|email)/i.test(r.el.type)||s.caretToEnd||r.saveCaret(e,e,r.$el);(s.initialFocus||r.$el.hasClass(t.css.initialFocus))&&t.caret(r.$preview,r.last);r.last.eventTime=(new Date).getTime();r.$el.trigger(t.events.kbVisible,[r,r.el]);r.timer=setTimeout((function(){r&&r.saveCaret()}),200)}),10);return r}};r.updateLanguage=function(){var a=t.layouts,i=s.language||a[s.layout]&&a[s.layout].lang&&a[s.layout].lang||[s.language||"en"],n=t.language;i="[object Array]"===Object.prototype.toString.call(i)?i[0]:i;r.language=i;i=i.split("-")[0];s.display=e.extend(true,{},n.en.display,n[i]&&n[i].display||{},r.settings.display);s.combos=e.extend(true,{},n.en.combos,n[i]&&n[i].combos||{},r.settings.combos);s.wheelMessage=n[i]&&n[i].wheelMessage||n.en.wheelMessage;s.rtl=a[s.layout]&&a[s.layout].rtl||n[i]&&n[i].rtl||false;n[i]&&n[i].comboRegex&&(r.regex=n[i].comboRegex);r.decimal=/^\./.test(s.display.dec);r.$el.toggleClass("rtl",s.rtl).css("direction",s.rtl?"rtl":"")};r.startup=function(){var a=t.css;(s.alwaysOpen||s.userClosed)&&r.$preview||r.makePreview();if(!r.hasKeyboard()){"custom"===s.layout&&(s.layoutHash="custom"+r.customHash());r.layout="custom"===s.layout?s.layoutHash:s.layout;r.last.layout=r.layout;r.updateLanguage();"undefined"===typeof t.builtLayouts[r.layout]&&("function"===typeof s.create?r.$keyboard=s.create(r):r.$keyboard.length||r.buildKeyboard(r.layout,true));r.$keyboard=t.builtLayouts[r.layout].$keyboard.clone();r.$keyboard.data("keyboard",r);""!==(r.el.id||"")&&r.$keyboard.attr("id",r.el.id+t.css.idSuffix);r.makePreview()}r.$keyboard.attr("data-"+a.keyboard+"-layout",s.layout).attr("data-"+a.keyboard+"-language",r.language);r.$decBtn=r.$keyboard.find("."+a.keyPrefix+"dec");(s.enterNavigation||r.isTextArea)&&r.alwaysAllowed.push(t.keyCodes.enter);r.bindKeyboard();r.$keyboard.appendTo(s.appendLocally?r.$el.parent():s.appendTo||"body");r.bindKeys();s.reposition&&e.ui&&e.ui.position&&"body"===s.appendTo&&e(window).bind("resize"+r.namespace,(function(){r.reposition()}))};r.reposition=function(){r.position=!e.isEmptyObject(s.position)&&s.position;if(e.ui&&e.ui.position&&r.position){r.position.of=r.position.of||r.$el.data("keyboardPosition")||r.$el;r.position.collision=r.position.collision||"flipfit flipfit";r.position.at=s.usePreview?s.position.at:s.position.at2;r.isVisible()&&r.$keyboard.position(r.position)}return r};r.makePreview=function(){if(s.usePreview){var a,i,n,o,l=t.css;r.$preview=r.$el.clone(false).data("keyboard",r).removeClass(l.placeholder+" "+l.input).addClass(l.preview+" "+s.css.input).attr("tabindex","-1").show();r.preview=r.$preview[0];o=/^(data-|id|aria-haspopup)/i;i=r.$preview.get(0).attributes;for(a=i.length-1;a>=0;a--){n=i[a]&&i[a].name;o.test(n)&&r.preview.removeAttribute(n)}e("<div />").addClass(l.wrapper).append(r.$preview).prependTo(r.$keyboard)}else{r.$preview=r.$el;r.preview=r.el}};r.caret=function(a,i){var n=t.caret(r.$preview,a,i),s=n instanceof e;if(s){r.saveCaret(n.start,n.end);return r}return n};r.saveCaret=function(e,a,i){if(r.isCurrent()){var n;n="undefined"===typeof e?t.caret(i||r.$preview):t.caret(i||r.$preview,e,a);r.last.start="undefined"===typeof e?n.start:e;r.last.end="undefined"===typeof a?n.end:a}};r.saveLastChange=function(e){r.last.val=e||r.getValue(r.$preview||r.$el);r.isContentEditable&&(r.last.elms=r.el.cloneNode(true))};r.setScroll=function(){if(!r.isContentEditable&&r.last.virtual){var e,a,i,n,o=r.last.val.substring(0,Math.max(r.last.start,r.last.end));if(!r.$previewCopy){r.$previewCopy=r.$preview.clone().removeAttr("id").css({position:"absolute",left:0,zIndex:-10,visibility:"hidden"}).addClass(t.css.inputClone);r.$previewCopy[0].disabled=true;r.isTextArea||r.$previewCopy.css({"white-space":"pre",width:0});s.usePreview?r.$preview.after(r.$previewCopy):r.$keyboard.prepend(r.$previewCopy)}if(r.isTextArea){r.$previewCopy.height(r.lineHeight).val(o);r.preview.scrollTop=r.lineHeight*(Math.floor(r.$previewCopy[0].scrollHeight/r.lineHeight)-1)}else{r.$previewCopy.val(o.replace(/\s/g," "));i=/c/i.test(s.scrollAdjustment)?r.preview.clientWidth/2:s.scrollAdjustment;e=r.$previewCopy[0].scrollWidth-1;if("undefined"===typeof r.last.scrollWidth){r.last.scrollWidth=e;r.last.direction=true}n=r.last.scrollWidth===e?r.last.direction:r.last.scrollWidth<e;a=r.preview.clientWidth-i;n?r.preview.scrollLeft=e<a?0:e-a:e>=r.preview.scrollWidth-a?r.preview.scrollLeft=r.preview.scrollWidth-i:r.preview.scrollLeft=e-i>0?e-i:0;r.last.scrollWidth=e;r.last.direction=n}}};r.bindFocus=function(){if(s.openOn&&r&&r.el.active){r.$el.bind(s.openOn+r.namespace,(function(){r.focusOn()}));e(":focus")[0]===r.el&&r.$el.blur()}};r.bindKeyboard=function(){var a,i=t.keyCodes,n=t.builtLayouts[r.layout],o=r.namespace+"keybindings";r.$preview.unbind(r.namespace).bind("click"+o+" touchstart"+o,(function(){s.alwaysOpen&&!r.isCurrent()&&r.reveal();r.timer2=setTimeout((function(){r&&r.saveCaret()}),150)})).bind("keypress"+o,(function(o){if(s.lockInput)return false;if(r.isCurrent()){var l=o.charCode||o.which,c=l>=i.A&&l<=i.Z,u=l>=i.a&&l<=i.z,d=r.last.key=String.fromCharCode(l);if(!(l<i.space)){r.last.virtual=false;r.last.event=o;r.last.$key=[];r.checkCaret&&r.saveCaret();if(l!==i.capsLock&&(c||u)){r.capsLock=c&&!o.shiftKey||u&&o.shiftKey;if(r.capsLock&&!r.shiftActive){r.shiftActive=true;r.showSet()}}if(s.restrictInput){if((o.which===i.backSpace||0===o.which)&&e.inArray(o.keyCode,r.alwaysAllowed))return;if(-1===e.inArray(d,n.acceptedKeys)){o.preventDefault();a=e.extend({},o);a.type=t.events.inputRestricted;r.$el.trigger(a,[r,r.el])}}else if((o.ctrlKey||o.metaKey)&&(o.which===i.A||o.which===i.C||o.which===i.V||o.which>=i.X&&o.which<=i.Z))return;if(n.hasMappedKeys&&n.mappedKeys.hasOwnProperty(d)){r.last.key=n.mappedKeys[d];r.insertText(r.last.key);o.preventDefault()}if("function"===typeof s.beforeInsert){r.insertText(r.last.key);o.preventDefault()}r.checkMaxLength()}}})).bind("keyup"+o,(function(a){if(r.isCurrent()){r.last.virtual=false;switch(a.which){case i.tab:if(r.tab&&!s.lockInput){r.shiftActive=a.shiftKey;var n=t.keyaction.tab(r);r.tab=false;if(!n)return false}else a.preventDefault();break;case i.escape:s.ignoreEsc||r.close(!(!s.autoAccept||!s.autoAcceptOnEsc)&&"true");return false}clearTimeout(r.throttled);r.throttled=setTimeout((function(){r&&r.isVisible()&&r.checkCombos()}),100);r.checkMaxLength();r.last.preVal=""+r.last.val;r.saveLastChange();var o=e.Event(t.events.kbChange);o.action=r.last.key;r.$el.trigger(o,[r,r.el]);if("function"===typeof s.change){o.type=t.events.inputChange;s.change(o,r,r.el);return false}if(s.acceptValid&&s.autoAcceptOnValid&&"function"===typeof s.validate&&s.validate(r,r.getValue(r.$preview))){r.$preview.blur();r.accept()}}})).bind("keydown"+o,(function(e){r.last.keyPress=e.which;s.alwaysOpen&&!r.isCurrent()&&r.reveal();if(e.which===i.tab){r.tab=true;return false}if(s.lockInput||e.timeStamp===r.last.timeStamp)return!s.lockInput;r.last.timeStamp=e.timeStamp;r.last.virtual=false;switch(e.which){case i.backSpace:t.keyaction.bksp(r,null,e);e.preventDefault();break;case i.enter:t.keyaction.enter(r,null,e);break;case i.capsLock:r.shiftActive=r.capsLock=!r.capsLock;r.showSet();break;case i.V:if(e.ctrlKey||e.metaKey){if(s.preventPaste){e.preventDefault();return}r.checkCombos()}break}})).bind("mouseup touchend ".split(" ").join(o+" "),(function(){r.last.virtual=true;r.saveCaret()}));r.$keyboard.bind("mousedown click touchstart ".split(" ").join(r.namespace+" "),(function(t){t.stopPropagation();if(!r.isCurrent()){r.reveal();e(r.el.ownerDocument).trigger("checkkeyboard"+r.namespace)}r.setFocus()}));if(s.preventPaste){r.$preview.bind("contextmenu"+r.namespace,(function(e){e.preventDefault()}));r.$el.bind("contextmenu"+r.namespace,(function(e){e.preventDefault()}))}};r.bindButton=function(i,n){var s="."+t.css.keyButton,callback=function(i){i.stopPropagation();i.$target=e(this||a).closest("."+t.css.keyboard+", ."+t.css.input);n.call(this||a,i)};e.fn.on?r.$keyboard.on(i,s,callback):e.fn.delegate&&r.$keyboard.delegate(s,i,callback);return r};r.unbindButton=function(a){e.fn.off?r.$keyboard.off(a):e.fn.undelegate&&r.$keyboard.undelegate("."+t.css.keyButton,a);return r};r.bindKeys=function(){var i=t.css;r.unbindButton(r.namespace+" "+r.namespace+"kb").bindButton("mouseenter mouseleave touchstart ".split(" ").join(r.namespace+" "),(function(t){if((s.alwaysOpen||s.userClosed)&&"mouseleave"!==t.type&&!r.isCurrent()){r.reveal();r.setFocus()}if(r.isCurrent()&&!(this||a).disabled){var i,n,o=r.last,l=e(this||a),c=t.type;if(s.useWheel&&r.wheel){i=r.getLayers(l);n=(i.length?i.map((function(){return e(this||a).attr("data-value")||""})).get():"")||[l.text()];o.wheel_$Keys=i;o.wheelLayers=n;o.wheelIndex=e.inArray(l.attr("data-value"),n)}if(("mouseenter"===c||"touchstart"===c)&&"password"!==r.el.type&&!l.hasClass(s.css.buttonDisabled)){l.addClass(s.css.buttonHover);s.useWheel&&r.wheel&&l.attr("title",(function(e,t){return r.wheel&&""===t&&r.sets&&n.length>1&&"touchstart"!==c?s.wheelMessage:t}))}if("mouseleave"===c){l.removeClass("password"===r.el.type?"":s.css.buttonHover);if(s.useWheel&&r.wheel){o.wheelIndex=0;o.wheelLayers=[];o.wheel_$Keys=[];l.attr("title",(function(e,t){return t===s.wheelMessage?"":t})).html(l.attr("data-html"))}}}})).bindButton(s.keyBinding.split(" ").join(r.namespace+" ")+r.namespace+" "+t.events.kbRepeater,(function(n){n.preventDefault();if(!r.$keyboard.is(":visible")||(this||a).disabled)return false;var o,l=r.last,c=e(this||a),u=(new Date).getTime();s.useWheel&&r.wheel&&(c=l.wheel_$Keys.length&&l.wheelIndex>-1?l.wheel_$Keys.eq(l.wheelIndex):c);o=c.attr("data-action");if(!(u-(l.eventTime||0)<s.preventDoubleEventTime)){l.eventTime=u;l.event=n;l.virtual=true;l.$key=c;l.key=c.attr("data-value");l.keyPress="";r.setFocus();/^meta/.test(o)&&(o="meta");if(o===l.key&&"string"===typeof t.keyaction[o])l.key=o=t.keyaction[o];else if(o in t.keyaction&&"function"===typeof t.keyaction[o]){if(false===t.keyaction[o](r,this||a,n))return false;o=null}if(!r.hasKeyboard())return false;if("undefined"!==typeof o&&null!==o){l.key=e(this||a).hasClass(i.keyAction)?o:l.key;r.insertText(l.key);if(!r.capsLock&&!s.stickyShift&&!n.shiftKey){r.shiftActive=false;r.showSet(c.attr("data-name"))}}t.caret(r.$preview,l);r.checkCombos();n=e.extend({},n,e.Event(t.events.kbChange));n.target=r.el;n.action=l.key;r.$el.trigger(n,[r,r.el]);l.preVal=""+l.val;r.saveLastChange();if("function"===typeof s.change){n.type=t.events.inputChange;s.change(n,r,r.el);return false}}})).bindButton("mouseup"+r.namespace+" "+"mouseleave touchend touchmove touchcancel ".split(" ").join(r.namespace+"kb "),(function(i){r.last.virtual=true;var n,o=e(this||a);if("touchmove"===i.type){n=o.offset();n.right=n.left+o.outerWidth();n.bottom=n.top+o.outerHeight();if(i.originalEvent.touches[0].pageX>=n.left&&i.originalEvent.touches[0].pageX<n.right&&i.originalEvent.touches[0].pageY>=n.top&&i.originalEvent.touches[0].pageY<n.bottom)return true}else if(/(mouseleave|touchend|touchcancel)/i.test(i.type))o.removeClass(s.css.buttonHover);else{!s.noFocus&&r.isCurrent()&&r.isVisible()&&r.$preview.focus();r.checkCaret&&t.caret(r.$preview,r.last)}r.mouseRepeat=[false,""];clearTimeout(r.repeater);if(s.acceptValid&&s.autoAcceptOnValid&&"function"===typeof s.validate&&s.validate(r,r.getValue())){r.$preview.blur();r.accept()}return false})).bindButton("click"+r.namespace,(function(){return false})).bindButton("mousewheel"+r.namespace,r.throttleEvent((function(t,n){var o=e(this||a);if(o&&!o.hasClass(i.keyAction)&&r.last.wheel_$Keys[0]===(this||a)&&s.useWheel&&r.wheel){n=n||t.deltaY;var l,c=r.last.wheelLayers||[];if(c.length>1){l=r.last.wheelIndex+(n>0?-1:1);l>c.length-1&&(l=0);l<0&&(l=c.length-1)}else l=0;r.last.wheelIndex=l;o.html(c[l]);return false}}),30)).bindButton("mousedown touchstart ".split(" ").join(r.namespace+"kb "),(function(){var t=e(this||a);if(t&&(!t.hasClass(i.keyAction)||t.is("."+i.keyPrefix+"tab bksp space enter".split(" ").join(",."+i.keyPrefix)))){if(0!==s.repeatRate){r.mouseRepeat=[true,t];setTimeout((function(){r&&r.mouseRepeat[0]&&r.mouseRepeat[1]===t&&!t[0].disabled&&r.repeatKey(t)}),s.repeatDelay)}return false}}))};r.throttleEvent=function(e,t){var i;return function(){if(!i){e.apply(this||a,arguments);i=true;setTimeout((function(){i=false}),t)}}};r.execCommand=function(e,t){r.el.ownerDocument.execCommand(e,false,t);r.el.normalize();s.reposition&&r.reposition()};r.getValue=function(e){e=e||r.$preview;return e[r.isContentEditable?"text":"val"]()};r.setValue=function(e,a){a=a||r.$preview;if(r.isContentEditable){if(e!==a.text()){t.replaceContent(a,e);r.saveCaret()}}else a.val(e);return r};r.insertText=function(e){if(!r.$preview)return r;"function"===typeof s.beforeInsert&&(e=s.beforeInsert(r.last.event,r,r.el,e));if("undefined"===typeof e||false===e){r.last.key="";return r}if(r.isContentEditable)return r.insertContentEditable(e);var a,i=false,n="\b"===e,o=r.getValue(),l=t.caret(r.$preview),c=o.length;l.end<l.start&&(l.end=l.start);l.start>c&&(l.end=l.start=c);if(r.isTextArea&&t.msie&&"\n"===o.substring(l.start,l.start+1)){l.start+=1;l.end+=1}a=l.start;if("{d}"===e){e="";l.end+=1}if(n){e="";i=n&&a===l.end&&a>0}o=o.substring(0,a-(i?1:0))+e+o.substring(l.end);a+=i?-1:e.length;r.setValue(o);r.saveCaret(a,a);r.setScroll();return r};r.insertContentEditable=function(e){r.$preview.focus();r.execCommand("insertText",e);r.saveCaret();return r};r.checkMaxLength=function(){if(r.$preview){var e,a,i=r.getValue(),n=r.isContentEditable?t.getEditableLength(r.el):i.length;if(false!==s.maxLength&&n>s.maxLength){e=t.caret(r.$preview).start;a=Math.min(e,s.maxLength);if(!s.maxInsert){i=r.last.val;a=e-1}r.setValue(i.substring(0,s.maxLength));r.saveCaret(a,a)}r.$decBtn.length&&r.checkDecimal();return r}};r.repeatKey=function(e){e.trigger(t.events.kbRepeater);r.mouseRepeat[0]&&(r.repeater=setTimeout((function(){r&&r.repeatKey(e)}),r.repeatTime))};r.getKeySet=function(){var e=[];r.altActive&&e.push("alt");r.shiftActive&&e.push("shift");r.metaActive&&e.push(r.metaActive);return e.length?e.join("+"):"normal"};r.showKeySet=function(e){if("string"===typeof e){r.last.keyset=[r.shiftActive,r.altActive,r.metaActive];r.shiftActive=/shift/i.test(e);r.altActive=/alt/i.test(e);if(/\bmeta/.test(e)){r.metaActive=true;r.showSet(e.match(/\bmeta[\w-]+/i)[0])}else{r.metaActive=false;r.showSet()}}else r.showSet(e);return r};r.showSet=function(e){if(r.hasKeyboard()){s=r.options;var a=t.css,i="."+a.keyPrefix,n=s.css.buttonActive,o="",l=(r.shiftActive?1:0)+(r.altActive?2:0);r.shiftActive||(r.capsLock=false);if(r.metaActive){r.shiftActive&&(e=(e||"").replace("-shift",""));r.altActive&&(e=(e||"").replace("-alt",""));o=/^meta/i.test(e)?e:"";""===o?o=true===r.metaActive?"":r.metaActive:r.metaActive=o;(!s.stickyShift&&r.last.keyset[2]!==r.metaActive||(r.shiftActive||r.altActive)&&!r.$keyboard.find("."+a.keySet+"-"+o+r.rows[l]).length)&&(r.shiftActive=r.altActive=false)}else!s.stickyShift&&r.last.keyset[2]!==r.metaActive&&r.shiftActive&&(r.shiftActive=r.altActive=false);l=(r.shiftActive?1:0)+(r.altActive?2:0);o=0!==l||r.metaActive?""===o?"":"-"+o:"-normal";if(r.$keyboard.find("."+a.keySet+o+r.rows[l]).length){r.$keyboard.find(i+"alt,"+i+"shift,."+a.keyAction+"[class*=meta]").removeClass(n).end().find(i+"alt").toggleClass(n,r.altActive).end().find(i+"shift").toggleClass(n,r.shiftActive).end().find(i+"lock").toggleClass(n,r.capsLock).end().find("."+a.keySet).hide().end().find("."+(a.keyAction+i+o).replace("--","-")).addClass(n);r.$keyboard.find("."+a.keySet+o+r.rows[l])[0].style.display="inline-block";r.metaActive&&r.$keyboard.find(i+r.metaActive).toggleClass(n,false!==r.metaActive);r.last.keyset=[r.shiftActive,r.altActive,r.metaActive];r.$el.trigger(t.events.kbKeysetChange,[r,r.el]);s.reposition&&r.reposition()}else{r.shiftActive=r.last.keyset[0];r.altActive=r.last.keyset[1];r.metaActive=r.last.keyset[2]}}};r.checkCombos=function(){if(!(r.isVisible()||r.hasKeyboard()&&r.$keyboard.hasClass(t.css.hasFocus)))return r.getValue(r.$preview||r.$el);var a,n,o,l,c=r.getValue(),u=t.caret(r.$preview),d=t.builtLayouts[r.layout],p=r.isContentEditable?t.getEditableLength(r.el):c.length,f=p;if(""===c){s.acceptValid&&r.checkValid();return c}u.end<u.start&&(u.end=u.start);u.start>f&&(u.end=u.start=f);if(t.msie&&"\n"===c.substring(u.start,u.start+1)){u.start+=1;u.end+=1}if(s.useCombos)if(t.msie)c=c.replace(r.regex,(function(e,t,a){return s.combos.hasOwnProperty(t)&&s.combos[t][a]||e}));else if(r.$preview.length){n=u.start-(u.start-2>=0?2:0);t.caret(r.$preview,n,u.end);n=t.caret(r.$preview);l=function(e){return(e||"").replace(r.regex,(function(e,t,a){return s.combos.hasOwnProperty(t)&&s.combos[t][a]||e}))};o=l(n.text);n&&n.replaceStr&&o!==n.text&&(r.isContentEditable?t.replaceContent(i,l):r.setValue(n.replaceStr(o)));c=r.getValue()}if(s.restrictInput&&""!==c){n=d.acceptedKeys.length;a=d.acceptedKeysRegex;if(!a){o=e.map(d.acceptedKeys,(function(e){return e.replace(r.escapeRegex,"\\$&")}));r.alwaysAllowed.indexOf(t.keyCodes.enter)>-1&&o.push("\\n");a=d.acceptedKeysRegex=new RegExp("("+o.join("|")+")","g")}o=c.match(a);if(o)c=o.join("");else{c="";f=0}}u.start+=p-f;u.end+=p-f;r.setValue(c);r.saveCaret(u.start,u.end);r.setScroll();r.checkMaxLength();s.acceptValid&&r.checkValid();return c};r.checkValid=function(){var e=t.css,a=r.$keyboard.find("."+e.keyPrefix+"accept"),i=true;"function"===typeof s.validate&&(i=s.validate(r,r.getValue(),false));a.toggleClass(e.inputInvalid,!i).toggleClass(e.inputValid,i).attr("title",a.attr("data-title")+" ("+s.display[i?"valid":"invalid"]+")")};r.checkDecimal=function(){r.decimal&&/\./g.test(r.preview.value)||!r.decimal&&/\,/g.test(r.preview.value)?r.$decBtn.attr({disabled:"disabled","aria-disabled":"true"}).removeClass(s.css.buttonHover).addClass(s.css.buttonDisabled):r.$decBtn.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass(s.css.buttonDefault).removeClass(s.css.buttonDisabled)};r.getLayers=function(i){var n=t.css,s=i.attr("data-pos"),r=i.closest("."+n.keyboard).find('button[data-pos="'+s+'"]');return r.filter((function(){return""!==e(this||a).find("."+n.keyText).text()})).add(i)};r.switchInput=function(t,a){if("function"===typeof s.switchInput)s.switchInput(r,t,a);else{r.$keyboard.length&&r.$keyboard.hide();var i,n=false,o=e("button, input, select, textarea, a, [contenteditable]").filter(":visible").not(":disabled"),l=o.index(r.$el)+(t?1:-1);r.$keyboard.length&&r.$keyboard.show();if(l>o.length-1){n=s.stopAtEnd;l=0}if(l<0){n=s.stopAtEnd;l=o.length-1}if(!n){a=r.close(a);if(!a)return;i=o.eq(l).data("keyboard");i&&i.options.openOn.length?i.focusOn():o.eq(l).focus()}}return false};r.close=function(e){if(r.isOpen&&r.$keyboard.length){clearTimeout(r.throttled);var a=t.css,i=t.events,n=e?r.checkCombos():r.originalContent;if(e&&"function"===typeof s.validate&&!s.validate(r,n,true)){n=r.originalContent;e=false;if(s.cancelClose)return}r.isCurrent(false);r.isOpen=s.alwaysOpen||s.userClosed;r.isContentEditable&&!e?r.$el.html(n):r.setValue(n,r.$el);r.$el.removeClass(a.isCurrent+" "+a.inputAutoAccepted).addClass(e||false?true===e?"":a.inputAutoAccepted:"").trigger(i.inputChange);s.alwaysOpen||r.$el.trigger(i.kbBeforeClose,[r,r.el,e||false]);t.caret(r.$preview,r.last);r.$el.trigger(e||false?i.inputAccepted:i.inputCanceled,[r,r.el]).trigger(s.alwaysOpen?i.kbInactive:i.kbHidden,[r,r.el]).blur();if(r){r.last.eventTime=(new Date).getTime();if(!(s.alwaysOpen||s.userClosed&&"true"===e)&&r.$keyboard.length){r.removeKeyboard();r.timer=setTimeout((function(){r&&r.bindFocus()}),200)}if(!r.watermark&&""===r.el.value&&""!==r.inPlaceholder){r.$el.addClass(a.placeholder);r.setValue(r.inPlaceholder,r.$el)}}}return!!e};r.accept=function(){return r.close(true)};r.checkClose=function(a){if(!r.opening){var i=e.keyboard.css,n=a.$target||e(a.target).closest("."+t.css.keyboard+", ."+t.css.input);n.length||(n=e(a.target));if(n.length&&n.hasClass(i.keyboard)){var o=n.data("keyboard");o!==r&&!o.$el.hasClass(i.isCurrent)&&o.options.openOn&&a.type===s.openOn&&o.focusOn()}else r.escClose(a,n)}};r.escCloseCallback={keepOpen:function(){return!r.isOpen}};r.escClose=function(a,i){if(r.isOpen){if(a&&"keyup"===a.type)return a.which!==t.keyCodes.escape||s.ignoreEsc?"":r.close(!(!s.autoAccept||!s.autoAcceptOnEsc)&&"true");var n=false,o=i.length&&i||e(a.target);e.each(r.escCloseCallback,(function(e,t){"function"===typeof t&&(n=n||t(o))}));if(!n&&(!r.isCurrent()&&r.isOpen||r.isOpen&&o[0]!==r.el)){if((s.stayOpen||s.userClosed)&&!o.hasClass(t.css.input))return;t.allie&&a.preventDefault();if(s.closeByClickEvent){var l=o[0]&&o[0].nodeName.toLowerCase();"input"!==l&&"textarea"!==l&&"click"!==a.type||r.close(!!s.autoAccept&&"true")}else r.close(!!s.autoAccept&&"true")}}};r.keyBtn=e("<button />").attr({role:"button",type:"button","aria-disabled":"false",tabindex:"-1"}).addClass(t.css.keyButton);r.processName=function(e){var t,a,i=(e||"").replace(/[^a-z0-9-_]/gi,""),n=i.length,s=[];if(n>1&&e===i)return e;n=e.length;if(n){for(t=0;t<n;t++){a=e[t];s.push(/[a-z0-9-_]/i.test(a)?/[-_]/.test(a)&&0!==t?"":a:(0===t?"":"-")+a.charCodeAt(0))}return s.join("")}return e};r.processKeys=function(t){var a,i,n=t.indexOf("</"),s={name:t,map:"",title:""};if(n>-1)return s;i=t.split(/:(?!\/\/)/);if(/\(.+\)/.test(i[0])||/^:\(.+\)/.test(t)||/\([(:)]\)/.test(t))if(/\([(:)]\)/.test(t)){a=i[0].match(/([^(]+)\((.+)\)/);if(a&&a.length){s.name=a[1];s.map=a[2];s.title=i.length>1?i.slice(1).join(":"):""}else{s.name=t.match(/([^(]+)/)[0];":"===s.name&&(i=i.slice(1));if(null===a){s.map=":";i=i.slice(2)}s.title=i.length?i.join(":"):""}}else{s.map=t.match(/\(([^()]+?)\)/)[1];t=t.replace(/\(([^()]+)\)/,"");a=t.split(":");if(""===a[0]){s.name=":";i=i.slice(1)}else s.name=a[0];s.title=i.length>1?i.slice(1).join(":"):""}else{if(""!==t&&""===i[0]){s.name=":";i=i.slice(1)}else s.name=i[0];s.title=i.length>1?i.slice(1).join(":"):""}s.title=e.trim(s.title).replace(/_/g," ");return s};r.addKey=function(e,a,i){var n,o,l,c={},u=r.processKeys(i?e:a),d=t.css;if(!i&&s.display[u.name]){l=r.processKeys(s.display[u.name]);l.action=r.processKeys(e).name}else{l=u;l.action=u.name}c.name=r.processName(u.name);if(""!==l.name)if(""!==l.map){t.builtLayouts[r.layout].mappedKeys[l.map]=l.name;t.builtLayouts[r.layout].acceptedKeys.push(l.name)}else i&&t.builtLayouts[r.layout].acceptedKeys.push(l.name);n=i?""===c.name?"":d.keyPrefix+c.name:d.keyAction+" "+d.keyPrefix+l.action;n+=(l.name.length>2?" "+d.keyWide:"")+" "+s.css.buttonDefault;c.html='<span class="'+d.keyText+'">'+l.name+"</span>";c.$key=r.keyBtn.clone().attr({"data-value":i?l.name:l.action,"data-name":l.action,"data-pos":r.temp[1]+","+r.temp[2],"data-action":l.action,"data-html":c.html}).addClass(n).html(c.html).appendTo(r.temp[0]);l.map&&c.$key.attr("data-mapped",l.map);(l.title||u.title)&&c.$key.attr({"data-title":u.title||l.title,title:u.title||l.title});if("function"===typeof s.buildKey){c=s.buildKey(r,c);o=c.$key.html();c.$key.attr("data-html",o)}return c.$key};r.customHash=function(e){var t,a,i,n,r,o=[],l=[];e="undefined"===typeof e?s.customLayout:e;for(a in e)e.hasOwnProperty(a)&&o.push(e[a]);l=l.concat.apply(l,o).join(" ");i=0;r=l.length;if(0===r)return i;for(t=0;t<r;t++){n=l.charCodeAt(t);i=(i<<5)-i+n;i&=i}return i};r.buildKeyboard=function(a,i){e.isEmptyObject(s.display)&&r.updateLanguage();var n,o,l,c,u=t.css,d=0,p=t.builtLayouts[a||r.layout||s.layout]={mappedKeys:{},acceptedKeys:[]},f=p.acceptedKeys=s.restrictInclude&&(""+s.restrictInclude).split(/\s+/)||[],h=u.keyboard+" "+s.css.popup+" "+s.css.container+(s.alwaysOpen||s.userClosed?" "+u.alwaysOpen:""),y=e("<div />").addClass(h).attr({role:"textbox"}).hide();n=e.inArray("{space}",f);n>-1&&(f[n]=" ");if(i&&"custom"===s.layout||!t.layouts.hasOwnProperty(s.layout)){s.layout="custom";h=t.layouts.custom=s.customLayout||{normal:["{cancel}"]}}else h=t.layouts[i?s.layout:a||r.layout||s.layout];e.each(h,(function(t,a){if(""!==t&&!/^(name|lang|rtl)$/i.test(t)){"default"===t&&(t="normal");d++;l=e("<div />").attr("name",t).addClass(u.keySet+" "+u.keySet+"-"+t).appendTo(y).toggle("normal"===t);for(o=0;o<a.length;o++){c=e.trim(a[o]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}");r.buildRow(l,o,c.split(/\s+/),f);l.find("."+u.keyButton+",."+u.keySpacer).filter(":last").after('<br class="'+u.endRow+'"/>')}}}));d>1&&(r.sets=true);p.hasMappedKeys=!e.isEmptyObject(p.mappedKeys);p.$keyboard=y;return y};r.buildRow=function(a,i,n,o){var l,c,u,d,p,f,h=t.css;for(u=0;u<n.length;u++){r.temp=[a,i,u];d=false;if(0!==n[u].length)if(/^\{\S+\}$/.test(n[u])){p=n[u].match(/^\{(\S+)\}$/)[1];if(/\!\!/.test(p)){p=p.replace("!!","");d=true}if(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i.test(p)){f=parseFloat(p.replace(/,/,".").match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0);e('<span class="'+h.keyText+'"></span>').width(p.match(/px/i)?f+"px":2*f+"em").addClass(h.keySpacer).appendTo(a)}if(/^empty(:((\d+)?([\.|,]\d+)?)(em|px)?)?$/i.test(p)){f=/:/.test(p)?parseFloat(p.replace(/,/,".").match(/^empty:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0):"";r.addKey(""," ",true).addClass(s.css.buttonDisabled+" "+s.css.buttonEmpty).attr("aria-disabled",true).width(f?p.match("px")?f+"px":2*f+"em":"");continue}if(/^meta[\w-]+\:?(\w+)?/i.test(p)){r.addKey(p.split(":")[0],p).addClass(h.keyHasActive);continue}c=p.split(":");switch(c[0].toLowerCase()){case"a":case"accept":r.addKey("accept",p).addClass(s.css.buttonAction+" "+h.keyAction);break;case"alt":case"altgr":r.addKey("alt",p).addClass(h.keyHasActive);break;case"b":case"bksp":r.addKey("bksp",p);break;case"c":case"cancel":r.addKey("cancel",p).addClass(s.css.buttonAction+" "+h.keyAction);break;case"combo":r.addKey("combo",p).addClass(h.keyHasActive).attr("title",(function(e,t){return t+" "+s.display[s.useCombos?"active":"disabled"]})).toggleClass(s.css.buttonActive,s.useCombos);break;case"dec":o.push(r.decimal?".":",");r.addKey("dec",p);break;case"e":case"enter":r.addKey("enter",p).addClass(s.css.buttonAction+" "+h.keyAction);break;case"lock":r.addKey("lock",p).addClass(h.keyHasActive);break;case"s":case"shift":r.addKey("shift",p).addClass(h.keyHasActive);break;case"sign":o.push("-");r.addKey("sign",p);break;case"space":o.push(" ");r.addKey("space",p);break;case"t":case"tab":r.addKey("tab",p);break;default:t.keyaction.hasOwnProperty(c[0])&&r.addKey(c[0],p).toggleClass(s.css.buttonAction+" "+h.keyAction,d)}}else{l=n[u];r.addKey(l,l,true)}}};r.removeBindings=function(t){e(document).unbind(t);r.el.ownerDocument!==document&&e(r.el.ownerDocument).unbind(t);e(window).unbind(t);r.$el.unbind(t)};r.removeKeyboard=function(){r.$decBtn=[];s.usePreview&&r.$preview.removeData("keyboard");r.$preview.unbind(r.namespace+"keybindings");r.preview=null;r.$preview=null;r.$previewCopy=null;r.$keyboard.removeData("keyboard");r.$keyboard.remove();r.$keyboard=[];r.isOpen=false;r.isCurrent(false)};r.destroy=function(e){var a,i=t.css,n=r.extensionNamespace.length,o=[i.input,i.locked,i.placeholder,i.noKeyboard,i.alwaysOpen,s.css.input,i.isCurrent].join(" ");clearTimeout(r.timer);clearTimeout(r.timer2);clearTimeout(r.timer3);r.$keyboard.length&&r.removeKeyboard();r.options.openOn&&r.removeBindings(r.options.openOn);r.removeBindings(r.namespace);r.removeBindings(r.namespace+"callbacks");for(a=0;a<n;a++)r.removeBindings(r.extensionNamespace[a]);r.el.active=false;r.$el.removeClass(o).removeAttr("aria-haspopup").removeAttr("role").removeData("keyboard");r=null;"function"===typeof e&&e()};r.init()};t.keyCodes={backSpace:8,tab:9,enter:13,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,A:65,Z:90,V:86,C:67,X:88,a:97,z:122};t.css={idSuffix:"_keyboard",initialFocus:"keyboard-init-focus",input:"ui-keyboard-input",inputClone:"ui-keyboard-preview-clone",wrapper:"ui-keyboard-preview-wrapper",preview:"ui-keyboard-preview",keyboard:"ui-keyboard",keySet:"ui-keyboard-keyset",keyButton:"ui-keyboard-button",keyWide:"ui-keyboard-widekey",keyPrefix:"ui-keyboard-",keyText:"ui-keyboard-text",keyHasActive:"ui-keyboard-hasactivestate",keyAction:"ui-keyboard-actionkey",keySpacer:"ui-keyboard-spacer",keyToggle:"ui-keyboard-toggle",keyDisabled:"ui-keyboard-disabled",divWrapperCE:"ui-keyboard-div-wrapper",locked:"ui-keyboard-lockedinput",alwaysOpen:"ui-keyboard-always-open",noKeyboard:"ui-keyboard-nokeyboard",placeholder:"ui-keyboard-placeholder",hasFocus:"ui-keyboard-has-focus",isCurrent:"ui-keyboard-input-current",inputValid:"ui-keyboard-valid-input",inputInvalid:"ui-keyboard-invalid-input",inputAutoAccepted:"ui-keyboard-autoaccepted",endRow:"ui-keyboard-button-endrow"};t.events={kbChange:"keyboardChange",kbBeforeClose:"beforeClose",kbBeforeVisible:"beforeVisible",kbVisible:"visible",kbInit:"initialized",kbInactive:"inactive",kbHidden:"hidden",kbRepeater:"repeater",kbKeysetChange:"keysetChange",inputAccepted:"accepted",inputCanceled:"canceled",inputChange:"change",inputRestricted:"restricted"};t.keyaction={accept:function(e){e.close(true);return false},alt:function(e){e.altActive=!e.altActive;e.showSet()},bksp:function(e){if(e.isContentEditable){e.execCommand("delete");e.saveCaret()}else e.insertText("\b")},cancel:function(e){e.close();return false},clear:function(e){e.$preview[e.isContentEditable?"text":"val"]("");e.$decBtn.length&&e.checkDecimal()},combo:function(e){var a=e.options,i=!a.useCombos,n=e.$keyboard.find("."+t.css.keyPrefix+"combo");a.useCombos=i;n.toggleClass(a.css.buttonActive,i).attr("title",n.attr("data-title")+" ("+a.display[i?"active":"disabled"]+")");i&&e.checkCombos();return false},dec:function(e){e.insertText(e.decimal?".":",")},del:function(e){e.isContentEditable?e.execCommand("forwardDelete"):e.insertText("{d}")},default:function(e){e.shiftActive=e.altActive=e.metaActive=false;e.showSet()},enter:function(a,i,n){var s=a.options;if(n.shiftKey)return s.enterNavigation?a.switchInput(!n[s.enterMod],true):a.close(true);if(s.enterNavigation&&(!a.isTextArea||n[s.enterMod]))return a.switchInput(!n[s.enterMod],!!s.autoAccept&&"true");a.isTextArea&&e(n.target).closest("button").length&&a.insertText((t.msie?" ":"")+"\n");if(a.isContentEditable&&!s.enterNavigation){a.execCommand("insertHTML",'<div><br class="'+t.css.divWrapperCE+'"></div>');setTimeout((function(){t.keyaction.right(a);a.saveCaret()}),0)}},lock:function(e){e.last.keyset[0]=e.shiftActive=e.capsLock=!e.capsLock;e.showSet()},left:function(e){var a=t.caret(e.$preview);if(a.start-1>=0){e.last.start=e.last.end=a.start-1;t.caret(e.$preview,e.last);e.setScroll()}},meta:function(t,a){var i=e(a);t.metaActive=!i.hasClass(t.options.css.buttonActive);t.showSet(i.attr("data-name"))},next:function(e){e.switchInput(true,e.options.autoAccept);return false},normal:function(e){e.shiftActive=e.altActive=e.metaActive=false;e.showSet()},prev:function(e){e.switchInput(false,e.options.autoAccept);return false},right:function(e){var a=t.caret(e.$preview),i=e.isContentEditable?t.getEditableLength(e.el):e.getValue().length;if(a.end+1<=i){e.last.start=e.last.end=a.end+1;t.caret(e.$preview,e.last);e.setScroll()}},shift:function(e){e.last.keyset[0]=e.shiftActive=!e.shiftActive;e.showSet()},sign:function(e){var a=e.decimal?/^[+-]?\d*\.?\d*$/:/^[+-]?\d*,?\d*$/;if(a.test(e.getValue())){var i,n=t.caret(e.$preview),s=e.getValue(),r=e.isContentEditable?t.getEditableLength(e.el):s.length;e.setValue(-1*s);i=r-s.length;e.last.start=n.start+i;e.last.end=n.end+i;t.caret(e.$preview,e.last);e.setScroll()}},space:function(e){e.insertText(" ")},tab:function(e){var t=e.options;if(!e.isTextArea){if(t.tabNavigation)return e.switchInput(!e.shiftActive,true);if(e.isInput)return false}e.insertText("\t")},toggle:function(e){e.enabled=!e.enabled;e.toggle()},NBSP:" ",ZWSP:"​",ZWNJ:"‌",ZWJ:"‍",LRM:"‎",RLM:"‏"};t.builtLayouts={};t.layouts={alpha:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}',"{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ ¡ ² ³ ¤ € ¼ ½ ¾ ‘ ’ ¥ × {bksp}","{tab} ä å é ® þ ü ú í ó ö « » ¬","á ß ð f g h j k ø ¶ ´ {enter}","{shift} æ x © v b ñ µ ç > ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["~ ¹ ² ³ £ € ¼ ½ ¾ ‘ ’ ¥ ÷ {bksp}","{tab} Ä Å É ® Þ Ü Ú Í Ó Ö « » ¦","Ä § Ð F G H J K Ø ° ¨ {enter}","{shift} Æ X ¢ V B Ñ µ Ç . ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"]},colemak:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w f p g j l u y ; [ ] \\","{bksp} a r s t d h n e i o ' {enter}","{shift} z x c v b k m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W F P G J L U Y : { } |",'{bksp} A R S T D H N E I O " {enter}',"{shift} Z X C V B K M < > ? {shift}","{accept} {space} {cancel}"]},dvorak:{normal:["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |',"A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{normal:["= ( ) {b}","{clear} / * -","7 8 9 +","4 5 6 {sign}","1 2 3 %","0 {dec} {a} {c}"]}};t.language={en:{display:{a:"✔:Accept (Shift+Enter)",accept:"Accept:Accept (Shift+Enter)",alt:"Alt:⌥ AltGr",b:"⌫:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"⏎:Enter",empty:" ",enter:"Enter:Enter ⏎",left:"←",lock:"Lock:⇪ Caps Lock",next:"Next ⇨",prev:"⇦ Prev",right:"→",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:" :Space",t:"⇥:Tab",tab:"⇥ Tab:Tab",toggle:" ",valid:"valid",invalid:"invalid",active:"active",disabled:"disabled"},wheelMessage:"Use mousewheel to see other keys",comboRegex:/([`\'~\^\"ao])([a-z])/gim,combos:{"`":{a:"à",A:"À",e:"è",E:"È",i:"ì",I:"Ì",o:"ò",O:"Ò",u:"ù",U:"Ù",y:"ỳ",Y:"Ỳ"},"'":{a:"á",A:"Á",e:"é",E:"É",i:"í",I:"Í",o:"ó",O:"Ó",u:"ú",U:"Ú",y:"ý",Y:"Ý"},'"':{a:"ä",A:"Ä",e:"ë",E:"Ë",i:"ï",I:"Ï",o:"ö",O:"Ö",u:"ü",U:"Ü",y:"ÿ",Y:"Ÿ"},"^":{a:"â",A:"Â",e:"ê",E:"Ê",i:"î",I:"Î",o:"ô",O:"Ô",u:"û",U:"Û",y:"ŷ",Y:"Ŷ"},"~":{a:"ã",A:"Ã",e:"ẽ",E:"Ẽ",i:"ĩ",I:"Ĩ",o:"õ",O:"Õ",u:"ũ",U:"Ũ",y:"ỹ",Y:"Ỹ",n:"ñ",N:"Ñ"}}}};t.defaultOptions={language:null,rtl:false,layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top",at2:"center bottom"},reposition:true,usePreview:true,alwaysOpen:false,initialFocus:true,noFocus:false,stayOpen:false,userClosed:false,ignoreEsc:false,closeByClickEvent:false,css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",popup:"",buttonDefault:"ui-state-default ui-corner-all",buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonActive:"ui-state-active",buttonDisabled:"ui-state-disabled",buttonEmpty:"ui-keyboard-empty"},autoAccept:false,autoAcceptOnEsc:false,lockInput:false,restrictInput:false,restrictInclude:"",acceptValid:false,autoAcceptOnValid:false,checkValidOnInit:true,cancelClose:true,tabNavigation:false,enterNavigation:false,enterMod:"altKey",stopAtEnd:true,appendLocally:false,appendTo:"body",wrapBRs:true,stickyShift:true,preventPaste:false,caretToEnd:false,scrollAdjustment:10,maxLength:false,maxInsert:true,repeatDelay:500,repeatRate:20,resetDefault:true,openOn:"focus",activeOnReadonly:false,keyBinding:"mousedown touchstart",useWheel:true,useCombos:true,validate:function(){return true}};t.supportedInputTypes=["text","search","url","tel","password"];t.comboRegex=/([`\'~\^\"ao])([a-z])/gim;t.currentKeyboard="";e('\x3c!--[if lte IE 8]><script>jQuery("body").addClass("oldie");<\/script><![endif]--\x3e\x3c!--[if IE]><script>jQuery("body").addClass("ie");<\/script><![endif]--\x3e').appendTo("body").remove();t.msie=e("body").hasClass("oldie");t.allie=e("body").hasClass("ie");t.watermark="undefined"!==typeof document.createElement("input").placeholder;t.checkCaretSupport=function(){if("boolean"!==typeof t.checkCaret){var a=document.activeElement;var i=e('<div style="height:0px;width:0px;overflow:hidden;position:fixed;top:0;left:-100px;"><input type="text" value="testing"/></div>').prependTo("body");t.caret(i.find("input"),3,3);t.checkCaret=3!==t.caret(i.find("input").hide().show()).start;i.remove();a&&a.focus&&a.focus()}return t.checkCaret};t.caret=function(e,a,i){if(!e||!e.length||e.is(":hidden")||"hidden"===e.css("visibility"))return{};var n,s,r,o,l=e.data("keyboard"),c=l&&l.options.noFocus,u=/(textarea|input)/i.test(e[0].nodeName);c||e.focus();if("undefined"!==typeof a){if("object"===typeof a&&"start"in a&&"end"in a){n=a.start;s=a.end}else"undefined"===typeof i&&(i=a);if("number"===typeof a&&"number"===typeof i){n=a;s=i}else"start"===a?n=s=0:"string"===typeof a&&(n=s="end");return u?e.caret(n,s,c):t.setEditableCaret(e,n,s)}o=u?e.caret():t.getEditableCaret(e[0]);n=o.start;s=o.end;r=u&&e[0].value||e.text()||"";return{start:n,end:s,text:r.substring(n,s),replaceStr:function(e){return r.substring(0,n)+e+r.substring(s,r.length)}}};t.isTextNode=function(e){return e&&3===e.nodeType};t.isBlock=function(e,t){var a=e.ownerDocument.defaultView;return t&&1===t.nodeType&&t!==e&&"block"===a.getComputedStyle(t).display?1:0};t.wrapBRs=function(a){var i=e(a).find("br:not(."+t.css.divWrapperCE+")");i.length&&e.each(i,(function(i,n){var s=n.parentNode.childNodes.length;(1!==s||1===s&&!t.isBlock(a,n.parentNode))&&e(n).addClass(t.css.divWrapperCE).wrap("<div>")}))};t.getEditableCaret=function(a){a=e(a)[0];if(!a.isContentEditable)return{};var i,n,s=(e(a).data("keyboard")||{}).options,r=a.ownerDocument,o=r.getSelection().getRangeAt(0),l=pathToNode(o.startContainer,o.startOffset),c=l.position;false!==s.wrapBRs&&t.wrapBRs(a);function pathToNode(i,n){var r,o,l="",c=false,u=0,d=e.makeArray(a.childNodes);function checkBlock(e){if(e){u+=e;l+=s&&s.replaceCR||"\n"}}while(!c&&d.length){r=d.shift();r===i&&(c=true);o=t.isBlock(a,r.previousSibling);checkBlock(o);if(t.isTextNode(r)){u+=c?n:r.length;l+=r.textContent;if(c)return{position:u,text:l}}else!c&&r.childNodes&&(d=e.makeArray(r.childNodes).concat(d));o=t.isTextNode(r.previousSibling)&&t.isBlock(a,r);checkBlock(o)}return{position:u,text:l}}if(o.endContainer===o.startContainer&&o.endOffset===o.startOffset){i=c;n=""}else{l=pathToNode(o.endContainer,o.endOffset);i=l.position;n=l.text.substring(c,i)}return{start:c,end:i,text:n}};t.getEditableLength=function(e){var a=t.setEditableCaret(e,"getMax");return"number"===typeof a?a:null};t.setEditableCaret=function(a,i,n){a=e(a)[0];if(!a.isContentEditable)return{};var s=a.ownerDocument,r=s.createRange(),o=s.getSelection(),l=(e(a).data("keyboard")||{}).options,c=i,u=n,d="",p=findNode("getMax"===i?"end":i);function findNode(i){"end"===i?i=a.innerHTML.length:i<0&&(i=0);var n,s,r="",o=false,c=0,u=0,d=0,p=e.makeArray(a.childNodes);function updateText(e){r+=e?l&&l.replaceCR||"\n":"";return e>0}function checkDone(e){var t=c+e;u=d;d+=e;if(i-t>=0){c=t;return i-c<=0}return i-t<=0}while(!o&&p.length){n=p.shift();s=t.isBlock(a,n.previousSibling);updateText(s)&&checkDone(s)&&(o=true);s=t.isTextNode(n.previousSibling)&&t.isBlock(a,n);updateText(s)&&checkDone(s)&&(o=true);if(t.isTextNode(n)){r+=n.textContent;if(checkDone(n.length)){s=i-c===0&&c-u>=1?n.length:i-c;return{node:n,offset:s,position:i,text:r}}}else!o&&n.childNodes&&(p=e.makeArray(n.childNodes).concat(p))}return p.length?{node:n,offset:i-c,position:i,text:r}:{node:n,offset:n&&n.length||0,position:d,text:r}}if(p.node){c=p.position;if("getMax"===i)return c;r.setStart(p.node,p.offset);"undefined"!==typeof n&&n!==i&&(p=findNode(n));if(p.node){u=p.position;r.setEnd(p.node,p.offset);d=c===u?"":p.text.substring(c,u)}o.removeAllRanges();o.addRange(r)}return{start:c,end:u,text:d}};t.replaceContent=function(a,i){a=e(a)[0];var n,s,r,o=typeof i,l=t.getEditableCaret(a).start,c=0,u=[a];while(n=u.pop())if(t.isTextNode(n)){if("function"===o)l>=c&&l<=c+n.length&&(n.textContent=i(n.textContent));else if("string"===o){r=i.substring(c,c+n.length);r!==n.textContent&&(n.textContent=r)}c+=n.length}else if(n&&n.childNodes){s=n.childNodes.length;while(s--)u.push(n.childNodes[s])}s=t.getEditableCaret(a);t.setEditableCaret(a,s.start,s.start)};e.fn.keyboard=function(t){return this.each((function(){e(this||a).data("keyboard")||new e.keyboard(this||a,t)}))};e.fn.getkeyboard=function(){return this.data("keyboard")};e.fn.caret=function(e,t,i){if("undefined"===typeof(this||a)[0]||this.is(":hidden")||"hidden"===this.css("visibility")||!/(INPUT|TEXTAREA)/i.test((this||a)[0].nodeName))return this||a;var n,s,r,o,l,c=this||a,u=c[0],d=u.ownerDocument.selection,p=u.scrollTop,f=false,h=true;try{f="selectionStart"in u}catch(e){h=false}if(h&&"undefined"!==typeof e){if(!/(email|number)/i.test(u.type))if(f){u.selectionStart=e;u.selectionEnd=t}else{n=u.createTextRange();n.collapse(true);n.moveStart("character",e);n.moveEnd("character",t-e);n.select()}i||!c.is(":visible")&&"hidden"===c.css("visibility")||u.focus();u.scrollTop=p;return this||a}if(/(email|number)/i.test(u.type))e=t=c.val().length;else if(f){e=u.selectionStart;t=u.selectionEnd}else if(d)if("TEXTAREA"===u.nodeName.toUpperCase()){l=c.val();s=d.createRange();r=s.duplicate();r.moveToElementText(u);r.setEndPoint("EndToEnd",s);e=r.text.replace(/\r/g,"\n").length;t=e+s.text.replace(/\r/g,"\n").length}else{l=c.val().replace(/\r/g,"\n");s=d.createRange().duplicate();s.moveEnd("character",l.length);e=""===s.text?l.length:l.lastIndexOf(s.text);s=d.createRange().duplicate();s.moveStart("character",-l.length);t=s.text.length}else e=t=(u.value||"").length;o=u.value||"";return{start:e,end:t,text:o.substring(e,t),replace:function(a){return o.substring(0,e)+a+o.substring(t,o.length)}}};return t}));var n=i;export{n as default};

