<%= form_with(model: order) do |form| %>
  <% if order.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(order.errors.count, "error") %> prohibited this order from being saved:</h2>

      <ul>
        <% order.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= field_set_tag "Items", id: "items-selected" do %>
    <%= form.fields_for :items do |item_form| %>

      <%= item_form.hidden_field :option_id, value: item_form.object.option_id %>
      <%= item_form.text_field :name, value: item_form.object.option.name %>
      <%= item_form.number_field :quantity, value: 1  %>
      <%= item_form.number_field :price,  step: :any , value: item_form.object.option.base_price %>

    <% end %>

  <% end %>
  
  <div>
    <%= form.label :price, style: "display: block" %>
    <%= form.number_field :price, step: :any%>
  </div>

  <div>
    <%= form.label :due_date, style: "display: block" %>
    <%= form.date_field :due_date %>
  </div>
  <%if params[:cust_id]%>
    <%= form.hidden_field :customer_id, value: params[:cust_id] %>
  <% else %>
    <%= form.hidden_field :customer_id, value: order.customer_id %>
  <% end %>

  <%= form.hidden_field :employee_id, value: current_user.id %>
  <% if params[:cust_id].present? || @new %>
    <%= form.hidden_field :status, value: Order.statuses[:created]%>
  <% else %>
    <%= form.label :status, "Order status: "%>
    <%= form.select :status, @filtered_options.keys.map { |k| [k.humanize, k] } %>
  <% end %>

  <div>
    <%= form.label :pre_paid, style: "display: block" %>
    <%= form.number_field :pre_paid, step: :any %>
  </div>

  <div>
    <%= form.label :items_count, style: "display: block" %>
    <%= form.number_field :items_count %>
  </div>

  <div>
    <%= form.submit %>
  </div>
<% end %>
<%=javascript_tag do %>
  let count = <%=@order.items.count%>
<% end %>

<%=javascript_include_tag 'orders' %>
