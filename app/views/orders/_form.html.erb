<%#= order.inspect %>
<%#= order.items.inspect %>

<%= form_with(model: order) do |form| %>
  <% if order.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(order.errors.count, "error") %> prohibited this order from being saved:</h2>

      <ul>
        <% order.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= field_set_tag "Items", id: "items-selected" do %>
    <%= form.fields_for :items do |item_form| %>
      <!--        <div class="field">-->
      <%#= item_form.number_field :quantity %>
      <!--        </div>
        <div class="field">
          <%#= item_form.number_field :price %>-->
      <!--        </div>-->

      <%= item_form.hidden_field :option_id, value: item_form.object.option_id %>
      <%= item_form.text_field :name, value: item_form.object.option.name %>
      <%= item_form.number_field :quantity, value: 1  %>
      <%= item_form.number_field :price,  step: :any , value: item_form.object.option.base_price %>

    <% end %>

  <% end %>

  <%#= link_to_add_association 'Add Item', form, :items %>

  <div>
    <%= form.label :price, style: "display: block" %>
    <%= form.number_field :price, step: :any%>
  </div>

  <div>
    <%= form.label :due_date, style: "display: block" %>
    <%= form.date_field :due_date %>
  </div>
  <%if params[:cust_id]%>
    <%= form.hidden_field :customer_id, value: params[:cust_id] %>
  <% else %>
    <%= form.hidden_field :customer_id, value: order.customer_id %>
  <% end %>

  <%= form.hidden_field :employee_id, value: current_user.id %>
  <% if params[:cust_id].present? || @new %>
    <%= form.hidden_field :status, value: Order.statuses[:created]%>
  <% else %>
    <%= form.label :status, "Order status: "%>
    <%= form.select :status, @filtered_options.keys.map { |k| [k.humanize, k] } %>
  <% end %>

  <div>
    <%= form.label :pre_paid, style: "display: block" %>
    <%= form.number_field :pre_paid, step: :any %>
  </div>

  <div>
    <%= form.label :items_count, style: "display: block" %>
    <%= form.number_field :items_count %>
  </div>

  <div>
    <%= form.submit %>
  </div>
<% end %>
<script>
  let count = <%=order.items.count%>;
      function addToOrder(option) {
      let elements = $(`#option-${option}`).children("p");
      console.log($(elements[0]).text());
      console.log($(elements[1]).text());
      let div = $('<div>');
      let quantityinput = $('<input>')
      .attr('type', 'number')
      .attr('name',`order[items_attributes][${count}][quantity]`)
      .attr('id', `order_items_attributes_${count}_quantity`)
      .attr('value',1)
      .addClass("numeric integer required");

      let priceinput = $('<input>')
      .attr('type', 'number')
      .attr('name',`order[items_attributes][${count}][price]`)
      .attr('id', `order_items_attributes_${count}_price`)
      .attr('value', $(elements[1]).text());

      let optioninput = $('<input>')
      .attr('type', 'hidden')
      .attr('name',`order[items_attributes][${count}][option_id]`)
      .attr('id', `order_items_attributes_${count}_option_id`)
      .attr('value', option);

      let nameinput = $('<input>')
      .attr('type', 'text')
      .attr('name',`order[items_attributes][${count}][name]`)
      .attr('id', `order_items_attributes_${count}_name`)
      .attr('value', $(elements[0]).text())
      .addClass("string required");
      div.append(quantityinput);
      div.append(nameinput);
      div.append(optioninput);
      div.append(priceinput);
      $("#items-selected").append(div);
      // $('#items-selected').append(nameinput);
      // $('#items-selected').append(quantityinput);
      // $('#items-selected').append(optioninput);
      // $('#items-selected').append(priceinput);
      count++;
      }
</script>
